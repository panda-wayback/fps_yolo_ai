# 鼠标驱动控制器组件

## 概述

鼠标驱动控制器组件是一个完整的UI界面，用于配置、监控和测试鼠标驱动功能。该组件集成了配置管理、状态显示和向量测试功能。

## 组件结构

```
mouse_driver/
├── index.py                    # 主入口文件
├── component/
│   ├── mouse_driver_config.py  # 配置组件
│   ├── mouse_driver_state.py   # 状态显示组件
│   └── mouse_driver_test.py    # 测试组件
└── README.md                   # 说明文档
```

## 功能特性

### 1. 配置组件 (mouse_driver_config.py)

**功能：**
- 鼠标驱动的参数配置
- 实时配置应用
- 参数验证和重置

**配置参数：**
- **运行状态**: 启用/禁用鼠标驱动
- **帧率**: 10-2000 FPS，默认1000 FPS
- **平滑系数**: 0.0-1.0，默认0.4
- **最大持续时间**: 0.001-0.1秒，默认0.05秒
- **减速系数**: 0.5-0.99，默认0.95

**UI控件：**
- 滑块控件用于精确调整参数
- 复选框控制运行状态
- 应用和重置按钮

### 2. 状态显示组件 (mouse_driver_state.py)

**功能：**
- 实时显示鼠标驱动运行状态
- 向量信息可视化
- 配置信息展示
- 统计信息记录

**显示内容：**
- **运行状态**: 运行中/停止/错误
- **当前向量**: X、Y坐标和可视化进度条
- **配置信息**: 当前所有配置参数
- **统计信息**: 向量发送次数和最后更新时间

**更新频率：** 100ms

### 3. 测试组件 (mouse_driver_test.py)

**功能：**
- 手动向量发送测试
- 预设向量快速测试
- 连续发送功能
- 向量输入和验证

**测试功能：**
- **手动输入**: 通过数字输入框设置向量
- **预设向量**: 8个方向预设按钮（上下左右+对角线）
- **连续发送**: 可设置发送次数和间隔的连续测试
- **实时反馈**: 发送状态和结果反馈

## 使用方法

### 基本使用

```python
from pyside.fps_ai_ui.component.mouse_driver.index import get_mouse_driver_component

# 获取完整组件
mouse_driver_widget = get_mouse_driver_component()

# 获取单独组件
config_widget = get_mouse_driver_config_component()
state_widget = get_mouse_driver_state_component()
test_widget = get_mouse_driver_test_component()
```

### 配置鼠标驱动

1. **设置基本参数**:
   - 调整帧率滑块设置目标帧率
   - 调整平滑系数控制移动平滑度
   - 设置最大持续时间限制单次移动时间
   - 调整减速系数控制移动衰减

2. **启用驱动**:
   - 勾选"启用鼠标驱动"复选框
   - 点击"应用配置"按钮保存设置

3. **监控状态**:
   - 查看状态组件中的运行状态
   - 观察当前向量和配置信息

### 测试向量发送

1. **手动测试**:
   - 在测试组件中输入X、Y坐标
   - 点击"发送向量"按钮测试
   - 使用预设方向按钮快速测试

2. **连续测试**:
   - 启用"连续发送"复选框
   - 设置发送间隔和次数
   - 观察连续发送效果

## 技术实现

### 数据绑定

组件通过以下方式与数据模型绑定：

```python
# 配置发送
MouseDriverSubject.send_config(config)

# 向量发送
MouseDriverSubject.send_vector((x, y))

# 状态获取
state = MouseDriverSubject.get_state()
```

### 实时更新

- **配置组件**: 参数改变时实时更新状态标签
- **状态组件**: 100ms定时器更新所有显示信息
- **测试组件**: 连续发送模式下的定时发送

### 错误处理

所有组件都包含完善的错误处理：
- 配置保存失败提示
- 向量发送错误显示
- 状态获取异常处理

## 样式设计

### 颜色方案

- **成功状态**: 绿色 (#4CAF50)
- **错误状态**: 红色 (#F44336)
- **警告状态**: 橙色 (#FF9800)
- **信息状态**: 蓝色 (#2196F3)
- **默认状态**: 灰色

### 布局设计

- **响应式布局**: 组件支持不同窗口大小
- **最小宽度设置**: 防止组件被过度压缩
- **合理间距**: 使用标准Qt布局间距

## 扩展功能

### 可扩展的配置参数

可以轻松添加新的配置参数：

```python
# 在MouseDriverConfigWidget中添加新参数
self.new_param_slider = ParameterSlider("新参数", 0, 100, 50, 1, " 单位")
self.new_param_slider.value_changed.connect(self.on_config_changed)
```

### 自定义测试模式

可以扩展测试功能：

```python
# 添加新的测试模式
def custom_test_mode(self):
    # 自定义测试逻辑
    pass
```

## 注意事项

1. **性能考虑**: 状态组件更新频率为100ms，避免过高频率影响性能
2. **向量范围**: 测试组件的向量范围限制在-1000到1000像素
3. **连续发送**: 连续发送模式有最大次数限制，防止无限循环
4. **错误恢复**: 所有错误都有相应的恢复机制和用户提示

## 依赖关系

- **PySide6**: UI框架
- **data_center.models.mouse_driver_model**: 数据模型
- **pyside.UI.basic**: 基础UI组件

## 版本历史

- **v1.0**: 初始版本，包含基本配置、状态和测试功能
- 支持完整的鼠标驱动参数配置
- 实时状态监控和向量测试功能
